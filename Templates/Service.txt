//
//  {{ name }}NetworkService.swift
//

import NodeKit

public class {{ name }}NetworkService: {{ name }}Service {
    {% if hasKeys %}
    // MARK: - Constants

    private enum Keys {
        {% for key in keys %}static let {{ key.name }} = "{{ key.serverName }}"{% if not forloop.last %}
        {% endif %}{% endfor %}
    }
    {% endif %}
    // MARK: - Private Properties

    private var builder: DefaultChain<{{ name }}UrlRoute> {
        return DefaultChain()
    }

    // MARK: - Public Methods

    {% for operation in operations %}func {{ operation.name }}({% for parameter in operation.pathParameters %}{#
    #}{{ parameter.name }}: String{% if not forloop.last or operation.hasQueryParameters or operation.hasBody %}, {% endif %}{% endfor %}{#
    #}{% for parameter in operation.queryParameters %}{{ parameter.name }}: {{ parameter.type }}{% if not forloop.last or operation.hasBody %}, {% endif %}{% endfor %}{#
    #}{% if operation.hasBody %}{% if operation.hasUnsupportedEncoding %}/* body with unsupported encoding */{% endif %}{#
    #}{% if operation.isBodyModel %}{{ operation.bodyModelName }}: {{ operation.bodyModelType }}{% endif %}{#
    #}{% if operation.isBodyArray %}{{ operation.bodyModelName }}: [{{ operation.bodyModelType }}]{% endif %}{#
    #}{% if operation.isBodyDictionary %}{% for parameter in operation.bodyParameters %}{{ parameter.name }}: {{ parameter.type }}{% if not forloop.last %}, {% endif %}{#
    #}{% endfor %}{% endif %}{% endif %}){#
    #} -> Observer<{% if operation.hasUndefinedResponseBody %}/* response with undefined model name */{#
    #}{% else %}{{ operation.responseModel }}{% endif %}> {
        {% if operation.hasUnsupportedEncoding %}// body with unsupported encoding: {{ operation.encodingDescription }}{% else %}{#
        #}return builder{% if operation.hasQueryParameters %}
            .set(query: [{% for parameter in operation.queryParameters %}{#
            #}Keys.{{ parameter.name }}: {{ parameter.name }}{% if not forloop.last %}, {% endif %}{% endfor %}]){% endif %}
            .route(.{{ operation.httpMethod }}, .{{ operation.path }}){% if operation.hasFormEncoding %}
            .encode(as: .formUrl){% endif %}
            .build()
            .process({% if operation.isBodyModel %}{{ operation.bodyModelName }}{% endif %}{#
            #}{% if operation.isBodyDictionary %}[{% for parameter in operation.bodyParameters %}{#
            #}Keys.{{ parameter.name }}: {{ parameter.name }}{% if not forloop.last %}, {% endif %}{% endfor %}]{% endif %})
        }{% endif %}
    }
{% if not forloop.last %}
    {% endif %}{% endfor %}
}
